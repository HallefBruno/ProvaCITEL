<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link href="https://unpkg.com/nprogress@0.2.0/nprogress.css" rel="stylesheet" />
        <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
    </head>
    <style>
        ::-webkit-scrollbar {
          width: 6px;
        }
        ::-webkit-scrollbar-track {
          background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
          background: #888; 
        }
        ::-webkit-scrollbar-thumb:hover {
          background: #555; 
        }
    </style>
    <body>
        <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Relatório geral do Emocentro</a>
            </div>
        </nav>
        <div id="app" style="margin-top: 80px; margin-bottom: 30px;">
            <div class="container">
                <div class="card shadow-sm rounded" style="background-color: #ededed">
                    <div class="card-body">
                        <div class="row mt-4">
                            <div class="col-sm-12 col-md-12 col-lg-6 mb-3">
                                <div class="card">
                                    <div class="card-header">
                                        Quantidade de candidatos por estado
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive" style="height: 300px">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                      <td>Total</td>
                                                      <td>Estado</td>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr v-for="obj in dados.quantidadeCandidatosPorEstado" :key="obj.estado">
                                                      <td v-text="obj.total"></td>
                                                      <td v-text="obj.estado"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-6 mb-3">
                                <div class="card">
                                    <div class="card-header">
                                        IMC médio
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive" style="height: 300px;">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                      <td>Faixa de idade</td>
                                                      <td>IMC médio</td>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr v-for="obj in dados.imcMedio" :key="obj.imcMedio">
                                                      <td v-text="obj.faixaIdade"></td>
                                                      <td v-text="obj.imcMedio"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-sm-12 col-md-12 col-lg-6 mb-3">
                                <div class="card">
                                    <div class="card-header">
                                        Percentual de obesos entre os homens e mulheres
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive" style="height: 300px;">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                      <td>Sexo</td>
                                                      <td>Obesos</td>
                                                      <td>Total</td>
                                                      <td>Percentual de obesos</td>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr v-for="obj in dados.obesosHomemMulher" :key="obj.sexo">
                                                      <td v-text="obj.sexo"></td>
                                                      <td v-text="obj.obesos"></td>
                                                      <td v-text="obj.total"></td>
                                                      <td v-text="obj.percentual"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-6 mb-3">
                                <div class="card">
                                    <div class="card-header">
                                        Média de idade para cada tipo sanguíneo
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive" style="height: 300px;">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                      <td>Tipo sanguineo</td>
                                                      <td>Média de idade</td>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr v-for="obj in dados.mediaIdadeSanguineo" :key="obj.tipoSanguineo">
                                                      <td v-text="obj.tipoSanguineo"></td>
                                                      <td v-text="obj.mediaIdade"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-6 mb-3">
                                <div class="card">
                                    <div class="card-header">
                                        Quantidade de possíveis doadores
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive" style="height: 300px;">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                      <td>Receptor</td>
                                                      <td>Quantidade de doadores</td>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr v-for="obj in dados.quantidadeDoadores" :key="obj.receptor">
                                                      <td v-text="obj.receptor"></td>
                                                      <td v-text="obj.quantidadeDoadores"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-1">
                            <div class="col-sm-12 col-md-8 col-lg-6">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fa-solid fa-folder-open"></i></span>
                                    <input @change="handleFileChange" type="file" ref="fileInput" class="form-control text-primary btn-sm" placeholder="Arquivo">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12 col-md-8 col-lg-6">
                                <button type="button" class="btn btn-primary btn-sm" @click="uploadFile"><i class="fa-solid fa-upload"></i> Enviar Arquivo</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.1/axios.min.js" integrity="sha512-emSwuKiMyYedRwflbZB2ghzX8Cw8fmNVgZ6yQNNXXagFzFOaQmbvQ1vmDkddHjm5AITcBIZfC7k4ShQSjgPAmQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            const App = {
                data() {
                  return {
                    dados:{},
                    selectedFile: null
                  };
                },
                created() {
                    
                },
                methods: {
                    init() {
                        NProgress.start();
                        axios.get("http://127.0.0.1:8081/api/emocentro/relatorio").then(response => {
                            this.dados = response.data;
                        }).catch(err => {
                            this.msgErro();
                            console.log(err);
                        });
                        NProgress.done();
                    },
                    
                    handleFileChange(event) {
                        this.selectedFile = event.target.files[0];
                    },
                    
                    uploadFile() {
                        if (!this.selectedFile) {
                            this.msgAtencao();
                            return;
                        }
                        NProgress.start();
                        const formData = new FormData();
                        formData.append("file", this.selectedFile);
                        axios.post("http://127.0.0.1:8081/api/emocentro/json-file-upload", formData, {
                            headers: {
                              "Content-Type": "multipart/form-data"
                            }
                        }).then(response => {
                            this.$refs.fileInput.value = '';
                            this.init();
                            this.selectedFile = null;
                            Swal.fire(
                                'Atenção!',
                                `${response.data}`,
                                'success'
                            );
                        }).catch(error => {
                            console.error("Erro ao enviar o arquivo:", error);
                            this.msgErro();
                        });
                        NProgress.done();
                    },
                    
                    msgErro() {
                        Swal.fire({
                            icon: 'error',
                            title: 'Atenção',
                            text: 'Desculpe ocorreu um erro!'
                        });
                    },
                    msgAtencao() {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Atenção',
                            text: 'Selecione um arquivo!'
                        });
                    }
                },
                mounted() {
                    this.init();
                }
            };
            Vue.createApp(App).mount("#app");
        </script>
    </body>
</html>